{
  "project": "tg-agent",
  "last_updated": "2026-02-17T00:00:00Z",
  "current_focus": null,
  "features": [
    {
      "id": "FEAT-001",
      "category": "core",
      "priority": "P0",
      "description": "Telegram webhook endpoint receives and validates messages",
      "steps": [
        "Send POST request to /telegram/webhook",
        "Verify request is validated against allowed users",
        "Verify message is processed or rejected appropriately"
      ],
      "passes": true,
      "verified_at": "2026-02-15T15:00:00Z",
      "verified_by": "manual testing + npm test",
      "notes": "Core webhook functionality complete"
    },
    {
      "id": "FEAT-002",
      "category": "core",
      "priority": "P0",
      "description": "User can send message to Claude via Telegram and receive response",
      "steps": [
        "Send text message to bot on Telegram",
        "Verify message is injected into tmux Claude session",
        "Verify Claude response is sent back to Telegram",
        "Verify markdown formatting is preserved"
      ],
      "passes": true,
      "verified_at": "2026-02-15T15:00:00Z",
      "verified_by": "end-to-end manual testing",
      "notes": "Core message flow working"
    },
    {
      "id": "FEAT-003",
      "category": "ux",
      "priority": "P0",
      "description": "Typing indicator shows while Claude is processing",
      "steps": [
        "Send message to bot",
        "Verify typing indicator appears",
        "Verify typing indicator continues until response sent",
        "Verify typing indicator stops when response arrives"
      ],
      "passes": true,
      "verified_at": "2026-02-15T14:00:00Z",
      "verified_by": "manual testing",
      "notes": "Periodic typing indicator implemented"
    },
    {
      "id": "FEAT-004",
      "category": "ux",
      "priority": "P1",
      "description": "Long messages are chunked with continuation markers",
      "steps": [
        "Send message that triggers long Claude response (>4096 chars)",
        "Verify message is split into chunks",
        "Verify continuation markers show percentage remaining",
        "Verify all chunks are received in order"
      ],
      "passes": true,
      "verified_at": "2026-02-15T14:30:00Z",
      "verified_by": "manual testing with long responses",
      "notes": "Chunking with percentage markers working"
    },
    {
      "id": "FEAT-005",
      "category": "ux",
      "priority": "P1",
      "description": "Code blocks are formatted with language labels",
      "steps": [
        "Send message that triggers code response",
        "Verify code block has language label",
        "Verify long code blocks are truncatedated with notice",
        "Verify markdown code formatting is correct"
      ],
      "passes": true,
      "verified_at": "2026-02-15T14:00:00Z",
      "verified_by": "manual testing",
      "notes": "Code formatting with truncation implemented"
    },
    {
      "id": "FEAT-006",
      "category": "reliability",
      "priority": "P0",
      "description": "Failed Telegram sends retry with exponential backoff",
      "steps": [
        "Simulate Telegram API failure",
        "Verify retry is attempted",
        "Verify backoff delay increases between retries",
        "Verify eventual success or failure notification"
      ],
      "passes": true,
      "verified_at": "2026-02-15T12:00:00Z",
      "verified_by": "unit tests (retry.test.ts)",
      "notes": "48 unit tests passing including retry logic"
    },
    {
      "id": "FEAT-007",
      "category": "reliability",
      "priority": "P1",
      "description": "Request timeout handling prevents hanging",
      "steps": [
        "Send request that would hang",
        "Verify 30s timeout triggers",
        "Verify proper error handling",
        "Verify server remains responsive"
      ],
      "passes": true,
      "verified_at": "2026-02-15T12:00:00Z",
      "verified_by": "unit tests + manual timeout testing",
      "notes": "AbortController with 30s timeout"
    },
    {
      "id": "FEAT-008",
      "category": "core",
      "priority": "P0",
      "description": "Bot commands work correctly (/start, /help, /clear, /stop, /status)",
      "steps": [
        "Send /start command, verify welcome message",
        "Send /help command, verify command list",
        "Send /clear command, verify Claude screen cleared",
        "Send /stop command, verify operation cancelled",
        "Send /status command, verify bridge status returned"
      ],
      "passes": true,
      "verified_at": "2026-02-15T15:00:00Z",
      "verified_by": "manual testing all commands",
      "notes": "All commands implemented and working"
    },
    {
      "id": "FEAT-009",
      "category": "core",
      "priority": "P0",
      "description": "Tool approval from Telegram with inline keyboard",
      "steps": [
        "Trigger Claude tool use requiring approval",
        "Verify approve/deny buttons appear in Telegram",
        "Tap approve, verify tool executes",
        "Tap deny, verify tool is rejected"
      ],
      "passes": true,
      "verified_at": "2026-02-15T15:00:00Z",
      "verified_by": "manual testing with tool approval flow",
      "notes": "Inline keyboard with callback queries working"
    },
    {
      "id": "FEAT-010",
      "category": "infra",
      "priority": "P1",
      "description": "Health check endpoints provide detailed status",
      "steps": [
        "GET /health returns basic status",
        "GET /health/detailed returns component status",
        "Verify all components report status",
        "Verify response time is acceptable"
      ],
      "passes": true,
      "verified_at": "2026-02-15T12:00:00Z",
      "verified_by": "curl tests",
      "notes": "Basic and detailed health endpoints"
    },
    {
      "id": "FEAT-011",
      "category": "core",
      "priority": "P2",
      "description": "Send pictures to Claude for analysis",
      "steps": [
        "Send photo to bot",
        "Verify photo is received and processed",
        "Verify photo is sent to Claude with Vision",
        "Verify Claude's analysis is returned"
      ],
      "passes": true,
      "verified_at": "2026-02-16T08:35:00Z",
      "verified_by": "git verification (commits 7ce2f1b, ede8281) + code review",
      "notes": "Implemented via PR #2 - photo.ts, client.ts, telegram.ts webhook handler"
    },
    {
      "id": "FEAT-012",
      "category": "infra",
      "priority": "P3",
      "description": "Cloudflared tunnel automatic reconnection",
      "steps": [
        "Start tunnel with cloudflared",
        "Simulate tunnel disconnection",
        "Verify automatic reconnection",
        "Verify webhook remains functional"
      ],
      "passes": false,
      "verified_at": null,
      "verified_by": null,
      "notes": "Low priority - manual restart acceptable"
    },
    {
      "id": "FEAT-013",
      "category": "infra",
      "priority": "P3",
      "description": "Scheduled messages via node-cron",
      "steps": [
        "Create schedule with /schedule command",
        "Verify schedule is stored",
        "Verify message sent at scheduled time",
        "Verify schedule can be cancelled"
      ],
      "passes": false,
      "verified_at": null,
      "verified_by": null,
      "notes": "Phase 4 - deferred per user request"
    },
    {
      "id": "FEAT-014",
      "category": "reliability",
      "priority": "P3",
      "description": "Improved logging with structured output",
      "steps": [
        "Verify logs include timestamps",
        "Verify logs include context (chat_id, message_id)",
        "Verify log levels work correctly",
        "Verify logs can be filtered"
      ],
      "passes": false,
      "verified_at": null,
      "verified_by": null,
      "notes": "Low priority enhancement"
    },
    {
      "id": "FEAT-015",
      "category": "reliability",
      "priority": "P1",
      "description": "Startup health hook verifies services are running",
      "steps": [
        "Start server and verify health checks run automatically",
        "Verify tmux session is checked",
        "Verify Telegram webhook is checked",
        "Verify state directory is checked",
        "Verify results are logged with clear status indicators",
        "Verify optional Telegram notification on startup"
      ],
      "passes": true,
      "verified_at": "2026-02-16T09:40:00Z",
      "verified_by": "npm run typecheck + npm test (48 passing)",
      "notes": "Implemented: src/health/startup-checks.ts, integrated into server startup"
    },
    {
      "id": "FEAT-016",
      "category": "core",
      "priority": "P2",
      "description": "Send files (PDF, TXT, CSV, etc.) to Claude for processing",
      "steps": [
        "Send PDF file to bot",
        "Verify file is received and downloaded",
        "Verify file is saved to workspace",
        "Verify Claude can process the file",
        "Verify Claude's response is returned"
      ],
      "passes": true,
      "verified_at": "2026-02-16T13:40:00Z",
      "verified_by": "npm run typecheck + npm test (48 passing)",
      "notes": "Implemented: src/telegram/document.ts, src/server/routes/telegram.ts handler, .env.example config. Supports PDF, TXT, CSV, JSON, MD, XML with 20MB limit."
    },
    {
      "id": "FEAT-017",
      "category": "core",
      "priority": "P2",
      "description": "Selection list support for multi-option choices in approval hook",
      "steps": [
        "Hook script sends question with multiple options to Telegram",
        "User sees options as inline keyboard buttons",
        "User can select one or more options",
        "Selected option(s) are returned to Claude",
        "Multi-select mode with submit/cancel buttons works"
      ],
      "passes": true,
      "verified_at": "2026-02-16T13:42:00Z",
      "verified_by": "npm run typecheck + npm test (48 passing)",
      "notes": "Phase 1 (Core Single-Select MVP) implemented: src/state/selection.ts (state management), src/telegram/selection.ts (UI components), hooks/permission-request.mjs (AskUserQuestion handling), src/server/routes/telegram.ts (selection callbacks). Supports single-select, multi-select, custom text input, and cancel."
    },
    {
      "id": "FEAT-018",
      "category": "ux",
      "priority": "P2",
      "description": "Telegram notification when background agents/tasks complete",
      "steps": [
        "Detect when Claude Code background task completes",
        "Send Telegram notification with task name and status",
        "Include summary of what was accomplished",
        "User can configure notification preferences"
      ],
      "passes": true,
      "verified_at": "2026-02-16T13:58:00Z",
      "verified_by": "npm run typecheck + npm test (48 passing)",
      "notes": "Implemented: src/monitor/task-monitor.ts (file polling detection), integrated into server startup. Requires CLAUDE_SESSION_ID env var. Detection: 0-byte file = running, symlink = completed."
    },
    {
      "id": "FEAT-019",
      "category": "reliability",
      "priority": "P0",
      "description": "Fix long-running tasks not sending Telegram reply despite 24h timeout setting",
      "steps": [
        "Investigate why 10min+ tasks don't send Telegram reply",
        "Verify PENDING_TIMEOUT_MS is being read correctly in hook",
        "Check if .env is loaded in hook process",
        "Add debug logging to identify root cause",
        "Implement fix and verify with long-running task"
      ],
      "passes": true,
      "verified_at": "2026-02-16T14:10:00Z",
      "verified_by": "code review + syntax check",
      "notes": "Root cause: (1) .env still had PENDING_TIMEOUT_MS=600000 (10min), (2) hook wasn't loading .env properly. Fix: Updated .env to 86400000, added proper .env loading in send-to-telegram.mjs."
    },
    {
      "id": "FEAT-020",
      "category": "ux",
      "priority": "P1",
      "description": "Fix inconsistent delay when pressing Enter to send messages",
      "steps": [
        "Investigate current Enter key handling in message flow",
        "Identify source of inconsistent timing behavior",
        "Check debounce/throttle logic in message handler",
        "Review typing indicator timing interaction",
        "Implement consistent delay behavior",
        "Verify messages send with predictable timing"
      ],
      "passes": false,
      "verified_at": null,
      "verified_by": null,
      "notes": "Bug report from 2026-02-17 session. Enter key delay feels wonky - sometimes too fast, sometimes unexpected pause."
    }
  ],
  "metrics": {
    "total": 20,
    "passing": 16,
    "failing": 4
  }
}
